#!/command/with-contenv bashio
# shellcheck shell=bash
# ==============================================================================
# Buderus WPS Heat Pump Add-on - Finish Script
# Handles graceful cleanup when the service stops
# ==============================================================================

declare exit_code=${1:-0}
declare signal_name=${2:-UNKNOWN}

# Log service termination
if [ "${exit_code}" -eq 0 ]; then
    bashio::log.info "Buderus WPS service stopped gracefully"
else
    bashio::log.warning "Buderus WPS service exited with code ${exit_code} (signal: ${signal_name})"
fi

# Cleanup operations (if needed)
# The Python service handles its own cleanup via signal handlers

# Return appropriate exit code for S6
# Exit code 0 = normal termination, don't restart
# Exit code 1-125 = error, restart according to s6-supervise rules
exit "${exit_code}"
